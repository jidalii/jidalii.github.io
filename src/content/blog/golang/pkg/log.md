---
title: "Golang Standard Package: log"
description: "An overview and usage of the stardard package flag in Go."
date: 2024-11-23
category: "Golang"
tags: ["Golang Standard Package", "logger"]
---

# 1. Methods in log

## 1.1 Log

1. `Print`/ `Printf`/ `Println`: call Output to print to the standard logger.
2. `Panic`/ `Panicf`/ `Panicln`: equal to `Print` followed by a call to `panic()`.
3. `Fatal`/ `Fatalf`/ `Fatalln`: equal to `Print` followed by a call to `os.Exist(1)`.

### example:

```go
type User struct {
	Name string
	Age  int
}
func main() {
	u := User{
		Name: "Alice",
		Age:  18,
	}
	log.Printf("%s login, age:%d", u.Name, u.Age)
	// **output:** 
	// 2024/11/23 19:04:00 Alice login, age:18
	
	log.Panicf("Oh, system error when %s login", u.Name)
	// **output:**
	// panic: Oh, system error when Alice login
	//
  // goroutine 1 [running]:
  // log.Panicf({0x104d19fa4?, 0x5?}, {0x1400010cf28?, 0x0?, 0x1400010cf38?})
  
  log.Fatalf("Danger! hacker %s login", u.Name)
  // **output:**
  // 2024/11/23 19:06:45 Danger! hacker Alice login
  // exit status 1
}
```

## 1.2 Custom

### 0) logger struct

```go
type Logger struct {
	outMu sync.Mutex
	out   io.Writer                  // destination for output

	prefix    atomic.Pointer[string] // prefix on each line to identify the logger
	flag      atomic.Int32           // flags which control various aspects of the logger's behavior
	isDiscard atomic.Bool            // whether the logger should discard log messages
}
```

### 1) flags

The log library provides these predefined flags to **prefix to each log entry** generated by the Logger.

```go
const (
	Ldate         = 1 << iota     // the date in the local time zone: 2009/01/23
	Ltime                         // the time in the local time zone: 01:23:23
	Lmicroseconds                 // microsecond resolution: 01:23:23.123123.  assumes Ltime.
	Llongfile                     // full file name and line number: /a/b/c/d.go:23
	Lshortfile                    // final file name element and line number: d.go:23. overrides Llongfile
	LUTC                          // if Ldate or Ltime is set, use UTC rather than the local time zone
	Lmsgprefix                    // move the "prefix" from the beginning of the line to before the message
	LstdFlags     = Ldate | Ltime // initial values for the standard logger
)
```

example:

```go
log.SetFlags(log.Llongfile | log.LstdFlags)
log.Printf("%s login, age:%d", u.Name, u.Age)

// **output:**
// 2024/11/23 19:16:09 main.go:19: Alice login, age:18

log.SetFlags(log.Lshortfile | log.Ldate | log.Lmicroseconds)
log.Printf("%s login, age:%d", u.Name, u.Age)
// **output:**
// 2024/11/23 19:17:53.498562 main.go:19: Alice login, age:18
```

### 2) prefix of log message

The log library provides a `SetPrefix` method to allow users to set the output prefix for the standard logger:

```go
log.SetPrefix("[app]: ")
log.SetFlags(log.Lshortfile | log.Ldate | log.Lmicroseconds)
log.Printf("%s login, age:%d", u.Name, u.Age)

// **output:**
// [app]: 2024/11/23 19:19:47.075523 main.go:21: Alice login, age:18
```

### 3) log file

The log library also provdies a `SetOutput` method to set the output destination for the standard logger:

```go
logFile, err := os.OpenFile("./output.log", os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0644)
if err != nil {
	fmt.Println("open log file failed, err:", err)
	return
}

log.SetPrefix("[app]: ")
log.SetFlags(log.Lshortfile | log.Ldate | log.Lmicroseconds)
// the log message would be written to ./output.log, instead of the default CLI
log.SetOutput(logFile)

log.Printf("%s login, age:%d", u.Name, u.Age)
log.Printf("Hello, %s", u.Name)
```

### 4) create a custom logger

The `New` method creates a new `Logger`.

**Syntax:** `func New(out io.Writer, prefix string, flag int) *Logger`

```go
// the following logger behaves the same as the one above, except the prefix is "[new]: "
newLogger := log.New(logFile, "[new]: ", log.Lshortfile|log.Ldate|log.Lmicroseconds)
newLogger.Printf("Hello, %s", u.Name)
```

If you want to write to multiple places, you can use `io.MultiWriter`:

```go
writer1 := os.Stdout
writer2, err := os.OpenFile(logFileName, os.O_WRONLY|os.O_CREATE|os.O_APPEND, 0644)
if err != nil {
	log.Fatalf("create file log.txt failed: %v", err)
}

logger := log.New(io.MultiWriter(writer1, writer2), "[logger]: ", log.Lshortfile|log.LstdFlags)
logger.Printf("%s login, age:%d", u.Name, u.Age)
```

# 2. More customs

Sometimes, we want to categorize and prioritize log messages based on their severity and importance by different levels, like `Debug`, `Info`, `Error`, etc. Here how we can achieve that using the log library:

```go
var logFileName = "./output2.log"
var (
	InfoLogger  *log.Logger
	WarnLogger  *log.Logger
	DebugLogger *log.Logger
	ErrorLogger *log.Logger
	FatalLogger *log.Logger
)

func init() {
	logFile, err := os.OpenFile(logFileName, os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0666)
	if err != nil {
		log.Println("Unable to create Logger file:", err.Error())
		return
	}
	log.SetOutput(logFile)
	logFlag := log.Ldate | log.Ltime | log.Lshortfile
	InfoLogger = log.New(logFile, "Info:", logFlag)
	WarnLogger = log.New(logFile, "Warn:", logFlag)
	DebugLogger = log.New(logFile, "Debug:", logFlag)
	ErrorLogger = log.New(logFile, "Error:", logFlag)
	FatalLogger = log.New(logFile, "Fatal:", logFlag)
}

func main() {
	InfoLogger.Println("Starting Service!")
	t := time.Now()
	InfoLogger.Printf("Time taken: %s \n", time.Since(t))
  DebugLogger.Println("Debug: Service is running!")
  WarnLogger.Println("Warning: Service is about to shutdown!")
  ErrorLogger.Println("Error: Service is shutting down!")
  FatalLogger.Println("Fatal: Service shut down!")
}
```

Here comes the problems and limitation in functionalities:

1. The setup is complex and hard to maintain.
2. Not natively support different log levels.
3. Not support structured data (e.g. JSON).
4. Not support log filtering by log levels and sources.
5. Limited ability to customize log messages.

Thus, we might need to use other logger libraries, like slog and logrus.

---

To see the full example of the code, checkout this link: https://github.com/jidalii/go-playground/tree/main/log

# References

- https://pkg.go.dev/log
- https://medium.com/@swetha.alwaal/golang-standard-logging-package-00dffa20812f